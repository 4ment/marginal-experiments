
\newpage

# DS{{i}}
## Mean time
```{r}
filename = paste('DS',{{i}},sep="")
df = read.ds(filename)
df.time = df[['time']]
kable(df.time[order(df.time$median),])
```

\newpage

## ranking of KL divergences for 10 replicates
```{r}
ranking = df[['kl']] %>% group_by(rep) %>% mutate(rank=rank(KL)) %>%
  select(-c(KL, H, dataset))
maxrep = max(ranking$rep)
myorder = ranking %>% filter(rep==maxrep) %>% arrange(rank) %>% 
  ungroup()%>% select(algorithm)
ranking$algorithm = factor(ranking$algorithm, levels=myorder$algorithm)

right_label <- levels(ranking$algorithm)

ggplot(ranking, aes(x=rep, y=rank, col=algorithm)) +
  geom_line() +
  scale_y_reverse() + 
  geom_text(
    data = subset(ranking, rep == maxrep),
    aes(label = algorithm), hjust=-0.1, size=2) +
  theme(legend.position="none") +
  labs(x="Replicate", y="Ranking")
```

\newpage

## Marginals vs. SRF of replicate 1
```{r, fig.height=10, fig.width=20}
replicate = 1
df.plot = df[['plot']] %>% filter(rep==replicate) %>% ungroup() %>% select(-rep)
df.rmsd = df[['rmsd']] %>%ungroup()%>% mutate(rep=as.numeric(rep))
df.kl = df[['kl']] %>% mutate(algorithm=droplevels(algorithm))
temp = df.kl %>% full_join(df.rmsd, by=c('rep', 'algorithm', 'dataset')) %>%
  filter(rep==replicate)
temp = temp[match(origin,temp$algorithm),]

f = function(.o,.f,.kl,.rmsd) paste0('list(atop(atop(',
                                     'textstyle(',deparse(.f),'),',
                                     'textstyle(RMSD == ',round(.rmsd,5),')),',
                                     'textstyle(KL == ',round(.kl,5),')))')

label_formated= Map(.o=origin, .f=final2, .kl=temp$KL, .rmsd=temp$KL, f)
label_formated = label_formated[match(levels(df.plot$algorithm),names(label_formated))]
levels(df.plot$algorithm) = unlist(label_formated)
ggplot(df.plot, aes(x=SRF, y=marginal)) +
  theme(aspect.ratio = 1,strip.text.x = element_text(size = 10)) +
  facet_wrap( ~algorithm, scales = "free_y", ncol=4,labeller=label_parsed) +
  geom_point() +
  xlab("Sample relative frequency (log scale)") +
  ylab("Approximate marginal probability (log scale)")
```


\newpage

## Approximate posterior vs. SRF posteriors of replicate 1
```{r, fig.height=10, fig.width=20}
ggplot(df.plot, aes(x=SRF, y=Posterior)) +
  facet_wrap( ~algorithm, scales = "free_y", ncol=4,labeller=label_parsed) +
  theme(aspect.ratio = 1,strip.text.x = element_text(size = 10)) +
  geom_point(color='#66666670')+
  xlab("Sample relative frequency (log scale)") +
  ylab("Approximate posterior probability (log scale)")
```



\newpage

## Split posterior probabilities approximate vs. SRF (replicate 1)
```{r, fig.height=10, fig.width=20}
df.splits = df[['splits']] %>% mutate(rep=as.numeric(rep)) %>% 
  full_join(df.rmsd, by=c('algorithm','rep')) %>% 
  full_join(df.kl, by=c('algorithm','rep','dataset')) %>%
  filter(rep==replicate)
colors = c(rgb(225,198,47,max=255),rgb(102,194,165,max=255),rgb(252,141,98,max=255))
df.splits$color = colors[1]
df.splits[df.splits$RMSD<0.01,]$color = colors[2]
df.splits[df.splits$RMSD>0.05,]$color = colors[3]
df.splits$color = factor(df.splits$color, levels=colors)

df.splits = df.splits %>%
  mutate(algorithm=factor(algorithm, levels=temp$algorithm[order(temp$RMSD,decreasing=F)]))
label_formated= Map(.o=origin, .f=final2, .kl=temp$KL, .rmsd=temp$RMSD, f)
label_formated = label_formated[match(levels(df.splits$algorithm),names(label_formated))]
levels(df.splits$algorithm) = unlist(label_formated)
ggplot(df.splits, aes(x=f, y=fhat, color=color)) +
  facet_wrap( ~algorithm, scales = "free_y", ncol=4,labeller=label_parsed) +
  theme(aspect.ratio = 1,strip.text.x = element_text(size = 10), legend.position="none") +
  geom_point()+
  scale_color_manual(values=colors) +
  scale_x_continuous(breaks = c(0, 0.5, 1)) +
  labs(y="Approximate split posterior probability", x="SRF split posterior probabitlity")
```

